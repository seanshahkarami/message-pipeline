#!/bin/sh

while true; do
  case $(systemctl get-default) in
    waggle-core.target)
      echo 'Ensuring plugins are stopped.'
      systemctl stop 'waggle-plugin-*.service'
      ;;
    waggle-platform.target)
      echo 'Ensuring plugins are started.'
      cp /wagglerw/systemd/system/waggle-plugin-* /run/systemd/system
      systemctl start 'waggle-plugin-*.service'
      ;;
  esac

  sleep 60
done
