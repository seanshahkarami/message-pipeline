#!/usr/bin/env python3
import os
import re
import subprocess

url = os.environ['WAGGLE_PLUGIN_RABBITMQ_URL']
username, password = re.match('amqp://([^:]*):([^@]*)@', url).groups()

try:
    subprocess.check_call(['rabbitmqctl', 'authenticate_user', username, password])
except subprocess.CalledProcessError:
    subprocess.check_call(['rabbitmqctl', 'change_password', username, password])
