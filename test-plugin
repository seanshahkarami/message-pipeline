#!/usr/bin/env python3
import argparse
from pipeline import Plugin
import time

parser = argparse.ArgumentParser()
parser.add_argument('plugin_id')
parser.add_argument('plugin_major_version')
parser.add_argument('plugin_instance')
args = parser.parse_args()

plugin = Plugin({
    'plugin_id': int(args.plugin_id),
    'plugin_major_version': int(args.plugin_major_version),
    'plugin_instance': int(args.plugin_instance),
})

while True:
    print('processing waiting messages...')

    for msg in plugin.get_waiting_messages():
        print('run_id', plugin.run_id)
        print(msg)

    print('doing some sensor work...')
    time.sleep(3)

print('done')
