#!/usr/bin/env python3
from waggle.protocol.v0 import *

mailbox = {
    b'0123456789abcdef': 'to-0123456789abcdef',
    b'fedcba9876543210': 'to-fedcba9876543210',
}

routing_table = {
    (b'0123456789abcdef', b'fedcba9876543210'),
    (b'0123456789abcdef', b'0123456789abcdef'),
    (b'fedcba9876543210', b'fedcba9876543210'),
}


def isroutable(message):
    return (message['receiver_id'] in mailbox and
            (message['sender_id'], message['receiver_id']) in routing_table)


if __name__ == '__main__':
    data = pack_waggle_packets([{
        'sender_id': b'0123456789abcdef',
        'receiver_id': b'fedcba9876543210',
        'body': b'^this is a really, really important message!$',
    }] * 3)

    for message in unpack_waggle_packets(data):
        if isroutable(message):
            print('routing', message)
        else:
            print('dropping', message)
